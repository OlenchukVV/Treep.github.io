<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>Treep — Твой мухоморный друг</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
</head>
<body>
  <div id="app-container">

    <!-- Splash screen -->
    <div id="splash" class="screen active">
      <div class="logo" id="splash-logo" tabindex="0">T</div>
    </div>

    <!-- Login/Register screen -->
    <div id="login" class="screen">
      <h1>Вход / Регистрация в Treep</h1>
      
      <form id="login-form">
        <input type="text" id="nickname" placeholder="Ник (для регистрации)" autocomplete="off" />
        <input type="email" id="email" placeholder="Email" autocomplete="username" required />
        <input type="password" id="password" placeholder="Пароль" autocomplete="current-password" required minlength="6" />

        <div id="auth-buttons">
          <button type="submit" id="login-btn">Войти</button>
          <button type="button" id="register-btn">Зарегистрироваться</button>
        </div>
      </form>

      <p id="error-msg" class="error"></p>
    </div>

    <!-- Main content -->
    <div id="main" class="screen">
      <div id="top-buttons">
        <button class="tab-btn active" data-index="0">Профиль</button>
        <button class="tab-btn" data-index="1">Чаты</button>
        <button class="tab-btn" data-index="2">Группы</button>
      </div>

      <div id="tabs-wrapper">
        <!-- Профиль -->
        <section class="tab" id="profile">
          <h1>Профиль</h1>

          <!-- Аватар и загрузчик -->
          <img id="avatar-img" src="default-avatar.png" alt="Аватар" width="120" height="120"
               style="border-radius:50%; object-fit:cover; margin-bottom:10px;" />
          <input type="file" id="avatar-input" accept="image/*" />

          <p id="profile-info">Загрузка...</p>

          <div id="nickname-change">
            <input type="text" id="new-nickname" placeholder="Новый ник" />
            <button id="change-nickname-btn">Сменить ник</button>
          </div>

          <button id="logout-btn">Выйти</button>
          <p id="profile-message" class="info"></p>
        </section>

        <!-- Чаты -->
        <section class="tab" id="chats">
          <h1>Чаты</h1>
          <div id="users-list" style="overflow-y:auto; max-height:300px; border: 1px solid #444; border-radius: 8px; padding: 10px;">
          </div>
        </section>

        <!-- Группы -->
        <section class="tab" id="groups">
          <h1>Группы</h1>
          <p>Здесь будут групповые чаты.</p>
        </section>

        <!-- Окно активного чата -->
        <section class="tab" id="chat-window" style="display:none; flex-direction: column; height: 100%;">
          <button id="back-to-chats" style="margin-bottom:10px;">← Назад к списку чатов</button>
          <h2 id="chat-with-name">Чат</h2>
          <div id="messages" style="flex:1; overflow-y:auto; background:#222; padding:10px; border-radius:8px; margin-bottom:10px; color:#eee;"></div>
          <form id="message-form" style="display:flex; gap:10px;">
            <input id="message-input" type="text" placeholder="Введите сообщение..." style="flex:1; padding:10px; border-radius:5px; border:none;" autocomplete="off" />
            <button type="submit">Отправить</button>
          </form>
        </section>
      </div>
    </div>

  </div>

  <script src="firebase.js"></script>
  <script src="script.js"></script>
</body>
</html>
